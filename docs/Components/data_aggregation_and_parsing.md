Data Aggregation And Parsing
============================

!> complete me

Path of Exile's Items and Statistics
------------------------------------

There is a lot of different type of [items](https://www.poewiki.net/wiki/Item) in Path of Exile. Items of some types are derived from a basic model with a few small variations (ie. unique objects) whereas in other types the number of possible combinations is extremely large, so it is very rare to have the same object several times and this also implies that players need some amount to knowledge to compare items and their values.

![Item](../assets/ingame/not-priced-item.png)

An item is composed of multiple "simple" properties like `required level`, `rarity` or `item level` but also some specific properties called [modifiers(mods)](https://www.poewiki.net/wiki/Modifier). In the screenshot above you can see the textual represent representation of `mods` ie. `+23 TO STRENGTH`. 

These `mods` impact, in the game engine, other properties called [stats](https://www.poewiki.net/wiki/Stat), ie. `+23 TO STRENGTH` will increase the stat `additional_strength` by 23 points. 

But a `could` also impact multiple `stats` ie. `+13% TO FIRE AND COLD RESISTANCES` will increase stats `base_cold_damage_resistance_%` and `base_fire_damage_resistance_%`.

The simple properties and `stats` impacted by the `mods` are what we choose to use to represent and item inside our model.

Note that you can retrieve the textual representation of an object by simply `Ctrl+C` In-Game.

```
Item Class: Amulets
Rarity: Rare
Dread Medallion
Agate Amulet
--------
Requirements:
Level: 56
--------
Item Level: 72
--------
+23 to Strength and Intelligence (implicit)
--------
20% increased Cold Damage
29% increased Armour
+5% to all Elemental Resistances
+11% to Lightning Resistance
```

Path of Exile's Trading System
------------------------------

### Listing an Item

In order to trade items with other, a player can list its items using a in-game feature called `public stash tab`. Each player has on it's account a stash/chest which can be used to store items, a stash is composed of multiple tabs. Some of them could be marked as public and as soon it's the case the tab's content will be listed on the market. To put a price on an item the player will have to right-click on an object and put a note on it asking for anything he wants in exchange for the given item.

![Give Price To Item](../assets/ingame/give-price-to-item.png)
*Give a price to an item*

![Priced Item](../assets/ingame/priced-item.png)
*Priced item in public stash tab*

### Searching for listed items

The `market` is mainly accessed by PoE's player through the [Path of Exile Trade Website](https://www.pathofexile.com/trade) where they have access to complete form to find what they need. When it's the case and they want to buy something, they use the in-game chat system with an autogenerated message to start a transaction.

![Search and Whisper](../assets/tradewebsite/search-and-whisper.png)

### Public Stashes API

These data are coming from an API developed and exposed by Grinding Gear Games : [Public Stashes API](https://www.pathofexile.com/developer/docs/reference#publicstashes) it's publicly available but need specific authorization to have access to it. 

Here is an extract of answer for one call to this API :

```json
    {
        "next_change_id": "2484186886-2461856592-2386462237-2643539049-2572525706",
        "stashes": [
            {
                {
                    "id": "5599055e6eeffd375d0022e5f87e9f2482f8c33e32efd615ea26e3bb33c15911",
                    "public": true,
                    "stash": "Sell",
                    "items": [
                        {
                            "league": "Necropolis",
                            "id": "5748bbce06439f3c6ababa71e7464d44b2131999df474b2bbfbae57f6fcfb37d",
                            "name": "Damnation Snare",
                            "baseType": "Stygian Vise",
                            // other properties
                            "note": "~price 4 divine",
                            "implicitMods": [
                              "+20% to Chaos Resistance"
                            ],
                            "explicitMods": [
                              "+53 to Strength",
                              "+52 to Dexterity",
                              "Adds 6 to 14 Physical Damage to Attacks",
                              "Adds 1 to 14 Lightning Damage to Attacks",
                              "+70 to maximum Mana",
                              "16% increased Mana Regeneration Rate"
                            ]
                        }
                    ]
                }
            }
        ]
    }
```

### Path of Exile Currencies

Player can put whatever they want when asking for trade, but as any market, [currencies](https://www.poewiki.net/wiki/Currency) exist in Path of Exile ecosystem so generally player will ask for a certain amount of currency in exchange for their items.

Not all currencies have the same value meaning there's [exchange rates](https://poe.ninja/economy/settlers/currency) between different currencies knowing that the reference currency when taling about PoE trading is `Chaos Orb`.

crawler-of-exile
----------------

> Responsibilities : Consuming Public Stashes API and persisting the result in JSON files.
> [Sources](https://github.com/PricerOfExile/crawler-of-exile)

This pretty simple project is build with [Node.js](https://nodejs.org/en) and [Express](http://expressjs.com/). The Public Stashes API implements a paging system where you cannot know in advance the next page identifier, so the project has sequential calls to the API with a rate limit of 2 calls/minute as imposed by Grinding Gear Games.

parser-of-exile
----------------

> Responsibilities : Transform Public Stashes files into Model Items in order to train the model and expose an API receiving an InGame description of an item and call the model to predict its rank. 

This module is written in Java/Spring and is split in 3 modules :

### parser-of-exile-core 

Based on Path of Exile game engine configuration files (extracted using  [pathofexile-dat](https://github.com/SnosMe/poe-dat-viewer/blob/master/lib/README.md)) and data extracted from other third party tool [poe.ninja](poe.ninja) it provides features around items/stats, mods and currencies like :

- Listing all possible stats for a given item types
- Translating textual description into one or multiple `stats`
- Convert all prices into a common currency.

### parser-of-exile-command-line

It reads, filters and transforms items extracted from Public Stashed API in order to give them to model-trainer later.

### parser-of-exile-api

Exposes a `predict` API where it can receive a textual representation of an object.


